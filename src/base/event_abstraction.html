

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Abstraction &mdash; DTPatternRecognition 3.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=acc74ff5"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";





const initStyles = () => {
    const defaultStyle = document.createElement('style');
    defaultStyle.textContent = `pre.mermaid {
    /* Same as .mermaid-container > pre */
    display: block;
    width: 100%;
}

pre.mermaid > svg {
    /* Same as .mermaid-container > pre > svg */
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}`;
    document.head.appendChild(defaultStyle);

    const fullscreenStyle = document.createElement('style');
    fullscreenStyle.textContent = `.mermaid-container {
    display: flex;
    flex-direction: row;
    width: 100%;
}

.mermaid-container > pre {
    display: block;
    width: 100%;
}

.mermaid-container > pre > svg {
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}

.mermaid-fullscreen-btn {
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    font-size: 14px;
    line-height: 1;
    padding: 0;
    color: #333;
}

.mermaid-fullscreen-btn:hover {
    opacity: 100% !important;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
}

.mermaid-fullscreen-btn.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #e0e0e0;
}

.mermaid-fullscreen-btn.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 3px 10px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal {
    display: none;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 95vw;
    height: 100vh;
    background: rgba(255, 255, 255, 0.98);
    z-index: 9999;
    padding: 20px;
    overflow: auto;
}

.mermaid-fullscreen-modal.dark-theme {
    background: rgba(0, 0, 0, 0.98);
}

.mermaid-fullscreen-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen {
    position: relative;
    width: 95vw;
    height: 90vh;
    max-width: 95vw;
    max-height: 90vh;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen.dark-theme {
    background: #1a1a1a;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
}

.mermaid-container-fullscreen pre.mermaid {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen .mermaid svg {
    height: 100% !important;
    width: 100% !important;
    cursor: grab;
}

.mermaid-fullscreen-close {
    position: fixed !important;
    top: 20px !important;
    right: 20px !important;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    cursor: pointer;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.2s;
    font-size: 24px;
    line-height: 1;
    color: #333;
}

.mermaid-fullscreen-close:hover {
    background: white;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    transform: scale(1.1);
}

.mermaid-fullscreen-close.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e0e0e0;
}

.mermaid-fullscreen-close.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal .mermaid-fullscreen-btn {
    display: none !important;
}`;
    document.head.appendChild(fullscreenStyle);
}

// Detect if page has dark background
const isDarkTheme = () => {
    // We use a set of heuristics:
    // 1. Check for common dark mode classes or attributes
    // 2. Check computed background color brightness
    if (document.documentElement.classList.contains('dark') ||
        document.documentElement.getAttribute('data-theme') === 'dark' ||
        document.body.classList.contains('dark') ||
        document.body.getAttribute('data-theme') === 'dark') {
        // console.log("Dark theme detected via class/attribute");
        return true;
    }
    if (document.documentElement.classList.contains('light') ||
        document.documentElement.getAttribute('data-theme') === 'light' ||
        document.body.classList.contains('light') ||
        document.body.getAttribute('data-theme') === 'light') {
        // console.log("Light theme detected via class/attribute");
        return false;
    }
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        // console.log("Dark theme detected via prefers-color-scheme");
        return true;
    }
    const bgColor = window.getComputedStyle(document.body).backgroundColor;
    const match = bgColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)/);
    if (match) {
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        // console.log("Background color brightness:", brightness);
        return brightness < 128;
    }
    // console.log("No dark or light theme detected, defaulting to light theme");
    return false;
};

let darkTheme = isDarkTheme();
let modal = null;
let modalContent = null;
let previousScrollOffset = [window.scrollX, window.scrollY];

const runMermaid = async (rerun) => {
    console.log("Running mermaid diagrams, rerun =", rerun);
    // clear all existing mermaid charts
    let all_mermaids = document.querySelectorAll(".mermaid");

    if (rerun) {
        all_mermaids.forEach((el) => {
            if(!el.hasAttribute("data-original-code")) {
                // store original code
                // console.log(`Storing original code for first run: `, el.innerHTML);
                el.setAttribute('data-original-code', el.innerHTML);
            }
            if(el.getAttribute("data-processed") === "true") {
                // remove and restore original
                el.removeAttribute("data-processed");
                // console.log(`Restoring original code for re-run: `, el.getAttribute('data-original-code'));
                el.innerHTML = el.getAttribute('data-original-code');
            } else {
                // store original code
                // console.log(`Storing original code for re-run: `, el.innerHTML);
                el.setAttribute('data-original-code', el.innerHTML);
            }
        });
        await mermaid.run();
    }

    all_mermaids = document.querySelectorAll(".mermaid");
    const mermaids_processed = document.querySelectorAll(".mermaid[data-processed='true']");

    if ("False" === "True") {
        const mermaids_to_add_zoom = -1 === -1 ? all_mermaids.length : -1;
        if(mermaids_to_add_zoom > 0) {
            var svgs = d3.selectAll("");
            if(all_mermaids.length !== mermaids_processed.length) {
                setTimeout(() => runMermaid(false), 200);
                return;
            } else if(svgs.size() !== mermaids_to_add_zoom) {
                setTimeout(() => runMermaid(false), 200);
                return;
            } else {
                svgs.each(function() {
                    var svg = d3.select(this);
                    svg.html("<g class='wrapper'>" + svg.html() + "</g>");
                    var inner = svg.select("g");
                    var zoom = d3.zoom().on("zoom", function(event) {
                        inner.attr("transform", event.transform);
                    });
                    svg.call(zoom);
                });
            }
        }
    } else if(all_mermaids.length !== mermaids_processed.length) {
        // Wait for mermaid to process all diagrams
        setTimeout(() => runMermaid(false), 200);
        return;
    }

    // Stop here if not adding fullscreen capability
    if ("True" !== "True") return;

    if (modal !== null ) {
        // Destroy existing modal
        modal.remove();
        modal = null;
        modalContent = null;
    }

    modal = document.createElement('div');
    modal.className = 'mermaid-fullscreen-modal' + (darkTheme ? ' dark-theme' : '');
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');
    modal.setAttribute('aria-label', 'Fullscreen diagram viewer');
    modal.innerHTML = `
        <button class="mermaid-fullscreen-close${darkTheme ? ' dark-theme' : ''}" aria-label="Close fullscreen">✕</button>
        <div class="mermaid-container-fullscreen${darkTheme ? ' dark-theme' : ''}"></div>
    `;
    document.body.appendChild(modal);

    modalContent = modal.querySelector('.mermaid-container-fullscreen');
    const closeBtn = modal.querySelector('.mermaid-fullscreen-close');

    const closeModal = () => {
        modal.classList.remove('active');
        modalContent.innerHTML = '';
        document.body.style.overflow = ''
        window.scrollTo({left: previousScrollOffset[0], top: previousScrollOffset[1], behavior: 'instant'});
    };

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    document.querySelectorAll('.mermaid').forEach((mermaidDiv) => {
        if (mermaidDiv.parentNode.classList.contains('mermaid-container') ||
            mermaidDiv.closest('.mermaid-fullscreen-modal')) {
            // Already processed, adjust button class if needed
            const existingBtn = mermaidDiv.parentNode.querySelector('.mermaid-fullscreen-btn');
            if (existingBtn) {
                existingBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
            }
            return;
        }

        const container = document.createElement('div');
        container.className = 'mermaid-container';
        mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
        container.appendChild(mermaidDiv);

        const fullscreenBtn = document.createElement('button');
        fullscreenBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
        fullscreenBtn.setAttribute('aria-label', 'View diagram in fullscreen');
        fullscreenBtn.textContent = '⛶';
        fullscreenBtn.style.opacity = '50%';

        // Calculate dynamic position based on diagram's margin and padding
        const diagramStyle = window.getComputedStyle(mermaidDiv);
        const marginTop = parseFloat(diagramStyle.marginTop) || 0;
        const marginRight = parseFloat(diagramStyle.marginRight) || 0;
        const paddingTop = parseFloat(diagramStyle.paddingTop) || 0;
        const paddingRight = parseFloat(diagramStyle.paddingRight) || 0;
        fullscreenBtn.style.top = `${marginTop + paddingTop + 4}px`;
        fullscreenBtn.style.right = `${marginRight + paddingRight + 4}px`;

        fullscreenBtn.addEventListener('click', () => {
            previousScrollOffset = [window.scroll, window.scrollY];
            const clone = mermaidDiv.cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(clone);

            const svg = clone.querySelector('svg');
            if (svg) {
                svg.removeAttribute('width');
                svg.removeAttribute('height');
                svg.style.width = '100%';
                svg.style.height = 'auto';
                svg.style.maxWidth = '100%';
                svg.style.sdisplay = 'block';

                if ("False" === "True") {
                    setTimeout(() => {
                        const g = svg.querySelector('g');
                        if (g) {
                            var svgD3 = d3.select(svg);
                            svgD3.html("<g class='wrapper'>" + svgD3.html() + "</g>");
                            var inner = svgD3.select("g");
                            var zoom = d3.zoom().on("zoom", function(event) {
                                inner.attr("transform", event.transform);
                            });
                            svgD3.call(zoom);
                        }
                    }, 100);
                }
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        container.appendChild(fullscreenBtn);
    });
};

const load = async () => {
    initStyles();

    await runMermaid(true);

    const reRunIfThemeChanges = async () => {
        const newDarkTheme = isDarkTheme();
        if (newDarkTheme !== darkTheme) {
            darkTheme = newDarkTheme;
            console.log("Theme change detected, re-running mermaid with", darkTheme ? "dark" : "default", "theme");
            await mermaid.initialize(
                {...JSON.parse(
                    `{"startOnLoad": false}`
                ),
                ...{ darkMode: darkTheme, theme: darkTheme ? 'dark' : 'default' },
                }
            );
            await runMermaid(true);
        }
    };

    // Update theme classes when theme changes
    const themeObserver = new MutationObserver(reRunIfThemeChanges);
    themeObserver.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
    themeObserver.observe(document.body, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
};





console.log("Initializing mermaid with", darkTheme ? "dark" : "default", "theme");
mermaid.initialize(
    {...JSON.parse(
        `{"startOnLoad": false}`
    ),
    ...{ darkMode: darkTheme, theme: darkTheme ? 'dark' : 'default' },
    }
);

window.addEventListener("load", load);</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="NTuple Data Access" href="ntuple_data_access.html" />
    <link rel="prev" title="Particle Abstraction" href="particle_abstraction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            DTPatternRecognition
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="main.html">Base</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="particle_abstraction.html">Particle Abstraction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Event Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ntuple_data_access.html">NTuple Data Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration_management.html">Configuration Management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../command_line_interface.html">Command Line Interface (CLI)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DTPatternRecognition</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="main.html">Base</a></li>
      <li class="breadcrumb-item active">Event Abstraction</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/DanielEstrada971102/DTPatternRecognition" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="event-abstraction">
<h1>Event Abstraction<a class="headerlink" href="#event-abstraction" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">Event</span></code> class is designed to encapsulate the information of an event entry from a ROOT TTree, facilitating access
to it by abstracting into collections of <a class="reference internal" href="particle_abstraction.html"><span class="doc">Particles</span></a> instances and data members representing event metadata
(such as an index, event number, etc.).</p>
<p>Thanks to the design of the <code class="docutils literal notranslate"><span class="pre">Particle</span></code> class, the <code class="docutils literal notranslate"><span class="pre">Event</span></code> class can dynamically build particles
based on specifications from a <strong>configuration file</strong> as described in the <a class="reference internal" href="particle_abstraction.html"><span class="doc">Particle Abstraction</span></a>.
This file should contain information about the types of particles and how to build them, allowing for flexible and customizable event processing.</p>
<p>The dynamic particle-building feature searches in the config file for the map with key <code class="docutils literal notranslate"><span class="pre">particle_types</span></code>.
This should list each type of particle to be created with its respective specifications (see <a class="reference internal" href="particle_abstraction.html"><span class="doc">Particle Abstraction</span></a> for a specific example).</p>
<p class="rubric">Example <code class="docutils literal notranslate"><span class="pre">particle_types</span></code> structure in <code class="docutils literal notranslate"><span class="pre">run_config.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">particle_types</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">particle_name</span><span class="p">:</span>
<span class="w">    </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;path.to.particle_class&#39;</span><span class="w">  </span><span class="c1"># Optional: custom class, defaults to &#39;dtpr.particles.Particle&#39;</span>
<span class="w">    </span><span class="nt">amount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(int, TBranch&lt;int&gt; or TBranch&lt;vector&gt;)</span><span class="w">  </span><span class="c1"># How many particles to build per event</span>
<span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">      </span><span class="nt">attr_name</span><span class="p">:</span>
<span class="w">        </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;branch_name&#39;</span><span class="w">        </span><span class="c1"># Directly from a TTree branch</span>
<span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;expression&#39;</span><span class="w">           </span><span class="c1"># Python expression using other attributes</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;path.to.function&#39;</span><span class="w">      </span><span class="c1"># Callable, receives the particle as input</span>
<span class="w">    </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;expression&#39;</span><span class="w">             </span><span class="c1"># Optional: filter particles using &#39;p&#39; (particle) and &#39;ev&#39; (event)</span>
<span class="w">    </span><span class="nt">sorter</span><span class="p">:</span>
<span class="w">      </span><span class="nt">by</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;expression&#39;</span><span class="w">               </span><span class="c1"># Sorting key, can use &#39;p&#39; and &#39;ev&#39;</span>
<span class="w">      </span><span class="nt">reverse</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True/False</span><span class="w">            </span><span class="c1"># Optional: reverse sorting order</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Event</span></code> class creates <strong>n</strong> instances of the <code class="docutils literal notranslate"><span class="pre">Particle</span></code> class, where <strong>n</strong> is determined by the <code class="docutils literal notranslate"><span class="pre">amount</span></code> key.
Attributes are defined using the <code class="docutils literal notranslate"><span class="pre">branch</span></code> (direct mapping from TTree branches), <code class="docutils literal notranslate"><span class="pre">expr</span></code> (computed values using expressions), or <code class="docutils literal notranslate"><span class="pre">src</span></code> (callable methods).
The callable methods must accept the particle instance as an argument, and the expression can access the particle
instance attributes for any computation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">particle_types</span></code> map can also manage the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code>: Specifies the class path to be used for the particle. If not specified, it defaults to the <code class="docutils literal notranslate"><span class="pre">Particle</span></code> class.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filter</span></code>: Allows filtering of particles based on boolean conditions. These conditions can use the particle instance (referred to as <code class="docutils literal notranslate"><span class="pre">p</span></code>) and the root event entry (referred to as <code class="docutils literal notranslate"><span class="pre">ev</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sorter</span></code>: Sorts particles using Python’s <code class="docutils literal notranslate"><span class="pre">sorted()</span></code>. The <code class="docutils literal notranslate"><span class="pre">by</span></code> key specifies the sorting expression (which can also use <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">ev</span></code>), and the <code class="docutils literal notranslate"><span class="pre">reverse</span></code> key (default: <code class="docutils literal notranslate"><span class="pre">False</span></code>) can reverse the order.</p></li>
</ul>
<p>Internally, all particle collections are stored in a dictionary (<code class="docutils literal notranslate"><span class="pre">self._particles</span></code>) within the <code class="docutils literal notranslate"><span class="pre">Event</span></code> object. But, since
the <code class="docutils literal notranslate"><span class="pre">__getattr__</span></code> and <code class="docutils literal notranslate"><span class="pre">__setattr__</span></code> methods are overridden, you can access collections like <code class="docutils literal notranslate"><span class="pre">event.digis</span></code> directly.</p>
<p class="rubric">Example usage</p>
<p>To iterate over a TTree and create event instances with particles specified in the
<a class="reference download internal" download="" href="../../_downloads/f5460224d6fd97fc70da64df3fa38483/run_config.yaml"><code class="xref download docutils literal notranslate"><span class="pre">configuration</span> <span class="pre">file</span></code></a>, you can use the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ROOT</span><span class="w"> </span><span class="kn">import</span> <span class="n">TFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.base.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">RUN_CONFIG</span>

<span class="c1"># update the configuration file -&gt; if it is not set, it will use the default one &#39;run_config.yaml&#39;</span>
<span class="n">RUN_CONFIG</span><span class="o">.</span><span class="n">change_config_file</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">cf_path</span><span class="p">)</span>

<span class="c1"># first, create a TFile object to read the dt ntuple (this is not necessary by using NTuple Class)</span>
<span class="k">with</span> <span class="n">TFile</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ntuple</span><span class="p">:</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ntuple</span><span class="p">[</span><span class="s2">&quot;dtNtupleProducer/DTTREE;1&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">iev</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="c1"># use_config=True to use the configuration file to build the particles</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">iev</span><span class="p">,</span> <span class="n">ev</span><span class="o">=</span><span class="n">ev</span><span class="p">,</span> <span class="n">use_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Print the event summary</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">break</span>  <span class="c1"># break after the first event</span>
</pre></div>
</div>
<p class="rubric">Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; ------ Event 39956 info ------
    + Index: 0
    + Digis
        * Number of digis: 81
    + Segments
        * Number of segments: 8
    + Tps
        * Number of tps: 21
    + Genmuons
        * Number of genmuons: 2
        * GenMuon 0 info --&gt;
        --&gt; Pt: 258.0812683105469, Eta: -1.9664770364761353, Phi: 0.5708979964256287, Charge: -1, Matched_segments_stations: [], Showered: False
        * GenMuon 1 info --&gt;
        --&gt; Pt: 190.72511291503906, Eta: -0.2504693865776062, Phi: -2.558511257171631, Charge: 1, Matched_segments_stations: [], Showered: False
    + Emushowers
        * Number of emushowers: 0
    + Simhits
        * Number of simhits: 50
</pre></div>
</div>
<p class="rubric">How this Event is Built</p>
<p>The process of building the <code class="docutils literal notranslate"><span class="pre">Event</span></code> and populating it with <code class="docutils literal notranslate"><span class="pre">Particle</span></code> objects can be visualized as follows:</p>
<pre align="center" data-zoom-id="id-00556ba6-0686-4124-8c78-c7876a9d687f" id="event-building-process" class="mermaid align-center">
        sequenceDiagram
    participant User
    participant Event
    participant ROOTEntry
    participant RUN_CONFIG
    participant Particle

    User-&gt;&gt;Event: Create Event(index=0, ev=ROOTEntry, use_config=True)
    Event-&gt;&gt;RUN_CONFIG: Request particle_types configuration
    Note over RUN_CONFIG: (e.g., defines &quot;digis&quot;, &quot;segments&quot;, &quot;genmuons&quot;)
    loop For each configured particle type (e.g., &quot;digis&quot;)
        Event-&gt;&gt;ROOTEntry: Get number of instances (e.g., &quot;digi_nDigis&quot;)
        Note over ROOTEntry: Returns N for &quot;digis&quot;
        loop For each instance (e.g., digi 0 to N-1)
            Event-&gt;&gt;Particle: new Particle(index=i, ev=ROOTEntry, attributes={...})
            Note over Particle: Particle reads its attributes from ROOTEntry based on config
            Particle--&gt;&gt;Event: Return created Particle object
        end
        Event-&gt;&gt;Event: Store list of built particles (e.g., self.digis = [...])
    end
    Event--&gt;&gt;User: Return fully populated Event
    </pre><p><strong>Flow Explanation:</strong></p>
<ol class="arabic simple">
<li><p><strong>User Initiates Event:</strong> The user creates an <code class="docutils literal notranslate"><span class="pre">Event</span></code> object, providing it with a raw data entry from the NTuple and <code class="docutils literal notranslate"><span class="pre">use_config=True</span></code>.</p></li>
<li><p><strong>Event Consults Configuration:</strong> The <code class="docutils literal notranslate"><span class="pre">Event</span></code> looks to the <code class="docutils literal notranslate"><span class="pre">RUN_CONFIG</span></code> to determine which particle types to build and how to build them.</p></li>
<li><p><strong>Dynamic Particle Creation:</strong> For each particle type defined in the configuration:
- The <code class="docutils literal notranslate"><span class="pre">Event</span></code> determines how many particles of this type exist in the current raw data entry.
- For each particle, the <code class="docutils literal notranslate"><span class="pre">Event</span></code> creates a new <code class="docutils literal notranslate"><span class="pre">Particle</span></code> (or custom class) instance, which reads its attributes from the raw data or computes them as specified.
- All created particles are collected into a list and stored as an attribute of the <code class="docutils literal notranslate"><span class="pre">Event</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">event.digis</span></code>).</p></li>
<li><p><strong>Event Ready:</strong> After all particle types are built, the <code class="docutils literal notranslate"><span class="pre">Event</span></code> object is ready for analysis.</p></li>
</ol>
<p>On the other hand, the <code class="docutils literal notranslate"><span class="pre">Event</span></code> class is highly flexible and not restricted to TTree data. As demonstrated above, you can
define any type of attribute mapping in the configuration file or even create an empty event instance and then add attributes manually as needed.</p>
<p class="rubric">Example: manual event creation</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># initialize an empty event with index 1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<span class="c1"># It is possible to manually add particles or other attributes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Particle</span>

<span class="n">showers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Particle</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">wh</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">st</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Shower&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">]</span>  <span class="c1"># create 5 showers</span>
<span class="n">event</span><span class="o">.</span><span class="n">showers</span> <span class="o">=</span> <span class="n">showers</span>  <span class="c1"># add them to the event</span>

<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">showers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p class="rubric">Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; ------ Event 1 info ------
    + Index: 1
&gt;&gt; ------ Event 1 info ------
    + Index: 1
    + Showers
       * Number of showers: 5
&gt;&gt; Shower 4 info --&gt;
    + Wh: 1, Sc: 1, St: 1
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="particle_abstraction.html" class="btn btn-neutral float-left" title="Particle Abstraction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ntuple_data_access.html" class="btn btn-neutral float-right" title="NTuple Data Access" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Daniel Estrada, Universidad de Oviedo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>